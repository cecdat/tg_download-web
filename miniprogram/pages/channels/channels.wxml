<view class="container">
  <view class="header-section">
    <view class="title-main">é¢‘é“ç®¡ç†</view>
    <view class="title-sub">è®¾ç½®è¦ç›‘å¬ä¸‹è½½çš„ Telegram é¢‘é“æˆ–ç¾¤ç»„</view>
  </view>

  <view class="card">
    <view class="flex-between mb-24">
      <view class="section-title">ç›‘å¬åˆ—è¡¨</view>
      <view class="btn-add" bindtap="showAddChannelModal">+ æ·»åŠ </view>
    </view>
    
    <view wx:if="{{loading && channels.length === 0}}" class="flex-center py-40">
      <view class="loading-spinner"></view>
    </view>
    
    <view wx:elif="{{channels.length > 0}}">
      <view class="channel-card mb-20" wx:for="{{channels}}" wx:key="id">
        <view class="flex-between">
          <view class="channel-info">
            <view class="flex-row mb-10">
              <view class="font-bold text-md truncate">{{item.channel_name || item.channel_id}}</view>
              <view class="badge {{item.enabled ? 'badge-success' : 'badge-danger'}} ml-20">
                {{item.enabled ? 'è¿è¡Œä¸­' : 'å·²æš‚åœ'}}
              </view>
            </view>
            <view class="text-xs text-muted">
              è´¦å·: {{item.account_name}}
              <text wx:if="{{item.custom_path}}"> | è·¯å¾„: {{item.custom_path}}</text>
            </view>
          </view>
          
          <view class="action-btns">
            <view class="icon-btn toggle {{item.enabled ? 'active' : ''}}" bindtap="toggleChannelStatus" data-id="{{item.id}}" data-enabled="{{item.enabled}}">
              {{item.enabled ? 'â¸ï¸' : 'â–¶ï¸'}}
            </view>
            <view class="icon-btn edit" bindtap="showEditChannelModal" data-channel="{{item}}">âœï¸</view>
            <view class="icon-btn delete" bindtap="confirmDeleteChannel" data-id="{{item.id}}">ğŸ—‘ï¸</view>
          </view>
        </view>
      </view>
    </view>
    
    <view wx:else class="empty-state mt-40">
      <view class="empty-icon">ğŸ“¢</view>
      <text class="text-muted">æš‚æ— ç›‘å¬é¢‘é“ï¼Œè¯·ç‚¹å‡»å³ä¸Šè§’æ·»åŠ </text>
    </view>
  </view>
  
  <!-- æ·»åŠ /ç¼–è¾‘å¼¹çª— -->
  <view class="modal-mask" wx:if="{{showModal}}" bindtap="hideModal">
    <view class="modal-content" catchtap="stopBubble">
      <view class="modal-header">
        <view class="modal-title">{{isEdit ? 'ç¼–è¾‘é¢‘é“' : 'æ·»åŠ é¢‘é“'}}</view>
        <view class="modal-close" bindtap="hideModal">Ã—</view>
      </view>
      
      <view class="modal-body">
        <view class="input-group">
          <text class="input-label">æ‰€å±è´¦å·</text>
          <picker bindchange="onAccountChange" value="{{accountIndex}}" range="{{accounts}}" range-key="name">
            <view class="input-field flex-between">
              <text>{{accounts[accountIndex] && accounts[accountIndex].name ? accounts[accountIndex].name : 'è¯·é€‰æ‹©è´¦å·'}}</text>
              <text class="text-muted">â–¼</text>
            </view>
          </picker>
        </view>
        
        <view class="input-group">
          <text class="input-label">é¢‘é“ ID / é“¾æ¥</text>
          <input class="input-field" placeholder="ID æˆ– t.me é“¾æ¥" bindinput="onChannelIdInput" value="{{formData.channel_id}}" />
        </view>
        
        <view class="input-group">
          <text class="input-label">æ˜¾ç¤ºåç§° (å¯é€‰)</text>
          <input class="input-field" placeholder="åå°æ˜¾ç¤ºçš„åç§°" bindinput="onChannelNameInput" value="{{formData.channel_name}}" />
        </view>
        
        <view class="input-group">
          <text class="input-label">è‡ªå®šä¹‰ä¸‹è½½è·¯å¾„ (å¯é€‰)</text>
          <input class="input-field" placeholder="ç›¸å¯¹äºæ ¹ç›®å½•çš„è·¯å¾„" bindinput="onCustomPathInput" value="{{formData.custom_path}}" />
        </view>
        
        <view class="flex-between mt-20" bindtap="toggleEnabled">
          <text class="text-md">å¯ç”¨æ­¤é¢‘é“</text>
          <switch checked="{{formData.enabled}}" color="#5271FF" />
        </view>
        
        <view class="error-msg" wx:if="{{error}}">{{error}}</view>
        
        <view class="modal-footer mt-40">
          <view class="btn-secondary w-full" bindtap="hideModal">å–æ¶ˆ</view>
          <view class="btn-primary w-full" bindtap="saveChannel">{{isEdit ? 'ç¡®è®¤ä¿å­˜' : 'ç«‹å³æ·»åŠ '}}</view>
        </view>
      </view>
    </view>
  </view>
</view>
